config = '''
  [[inputs.jolokia2]]
    default_field_separator = "_"

    [[inputs.jolokia2.metric]]
      name         = "kafka_topic_summary"
      mbean        = "kafka.server:name=*,type=BrokerTopicMetrics"
      field_prefix = "$1"

    [[inputs.jolokia2.metric]]
      name         = "kafka_topic"
      mbean        = "kafka.server:name=*,topic=*,type=BrokerTopicMetrics"
      field_prefix = "$1"
      tag_keys     = ["topic"]
''' 

response = '''
  [{
    "request": {
      "mbean": "kafka.server:name=*,type=BrokerTopicMetrics",
      "type": "read"
    },
    "value": {
      "kafka.server:name=TotalProduceRequestsPerSec,type=BrokerTopicMetrics": {
        "RateUnit": "SECONDS",
        "OneMinuteRate": 123.0,
        "EventType": "requests",
        "Count": 123,
        "FifteenMinuteRate": 123.0,
        "FiveMinuteRate": 123.0,
        "MeanRate": 123.0
      },
      "kafka.server:name=BytesOutPerSec,type=BrokerTopicMetrics": {
        "RateUnit": "SECONDS",
        "OneMinuteRate": 456.0,
        "EventType": "bytes",
        "Count": 456,
        "FifteenMinuteRate": 456.0,
        "FiveMinuteRate": 456.0,
        "MeanRate": 456.0
      },
      "kafka.server:name=BytesInPerSec,type=BrokerTopicMetrics": {
        "RateUnit": "SECONDS",
        "OneMinuteRate": 789.0,
        "EventType": "bytes",
        "Count": 789,
        "FifteenMinuteRate": 789.0,
        "FiveMinuteRate": 789.0,
        "MeanRate": 789.0
      },
      "kafka.server:name=BytesRejectedPerSec,type=BrokerTopicMetrics": {
        "RateUnit": "SECONDS",
        "OneMinuteRate": 123.0,
        "EventType": "bytes",
        "Count": 123,
        "FifteenMinuteRate": 123.0,
        "FiveMinuteRate": 123.0,
        "MeanRate": 123.0 
      },
      "kafka.server:name=FailedProduceRequestsPerSec,type=BrokerTopicMetrics": {
        "RateUnit": "SECONDS",
        "OneMinuteRate": 456.0,
        "EventType": "requests",
        "Count": 456.0,
        "FifteenMinuteRate": 456.0,
        "FiveMinuteRate": 456.0,
        "MeanRate": 456.0
      },
      "kafka.server:name=MessagesInPerSec,type=BrokerTopicMetrics": {
        "RateUnit": "SECONDS",
        "OneMinuteRate": 789.0,
        "EventType": "messages",
        "Count": 789,
        "FifteenMinuteRate": 789.0,
        "FiveMinuteRate": 789.0,
        "MeanRate": 789.0
      },
      "kafka.server:name=FailedFetchRequestsPerSec,type=BrokerTopicMetrics": {
        "RateUnit": "SECONDS",
        "OneMinuteRate": 123.0,
        "EventType": "requests",
        "Count": 123,
        "FifteenMinuteRate": 123.0,
        "FiveMinuteRate": 123.0,
        "MeanRate": 123.0 
      },
      "kafka.server:name=TotalFetchRequestsPerSec,type=BrokerTopicMetrics": {
        "RateUnit": "SECONDS",
        "OneMinuteRate": 456.0,
        "EventType": "requests",
        "Count": 456.0,
        "FifteenMinuteRate": 456.0,
        "FiveMinuteRate": 456.0,
        "MeanRate": 456.0
      }
    },
    "timestamp": 1485055457,
    "status": 200
  },
  {
    "request": {
      "mbean": "kafka.server:name=*,topic=*,type=BrokerTopicMetrics",
      "type": "read"
    },
    "value": {
      "kafka.server:name=FailedProduceRequestsPerSec,topic=bar-logs,type=BrokerTopicMetrics": {
        "RateUnit": "SECONDS",
        "OneMinuteRate": 789.0,
        "EventType": "requests",
        "Count": 789,
        "FifteenMinuteRate": 789.0,
        "FiveMinuteRate": 789.0,
        "MeanRate": 789.0
      },
      "kafka.server:name=FailedFetchRequestsPerSec,topic=foo-logs,type=BrokerTopicMetrics": {
        "RateUnit": "SECONDS",
        "OneMinuteRate": 456.0,
        "EventType": "requests",
        "Count": 456,
        "FifteenMinuteRate": 456.0,
        "FiveMinuteRate": 456.0,
        "MeanRate": 456.0
      },
      "kafka.server:name=TotalFetchRequestsPerSec,topic=bar-logs,type=BrokerTopicMetrics": {
        "RateUnit": "SECONDS",
        "OneMinuteRate": 123.0,
        "EventType": "requests",
        "Count": 123,
        "FifteenMinuteRate": 123.0,
        "FiveMinuteRate": 123.0,
        "MeanRate": 123.0
      },
      "kafka.server:name=TotalFetchRequestsPerSec,topic=foo-logs,type=BrokerTopicMetrics": {
        "RateUnit": "SECONDS",
        "OneMinuteRate": 789.0,
        "EventType": "requests",
        "Count": 789,
        "FifteenMinuteRate": 789.0,
        "FiveMinuteRate": 789.0,
        "MeanRate": 789.0
      },
      "kafka.server:name=BytesInPerSec,topic=bar-logs,type=BrokerTopicMetrics": {
        "RateUnit": "SECONDS",
        "OneMinuteRate": 456.0,
        "EventType": "bytes",
        "Count": 456,
        "FifteenMinuteRate": 456.0,
        "FiveMinuteRate": 456.0,
        "MeanRate": 456.0
      },
      "kafka.server:name=MessagesInPerSec,topic=foo-logs,type=BrokerTopicMetrics": {
        "RateUnit": "SECONDS",
        "OneMinuteRate": 123.0,
        "EventType": "messages",
        "Count": 123,
        "FifteenMinuteRate": 123.0,
        "FiveMinuteRate": 123.0,
        "MeanRate": 123.0
      },
      "kafka.server:name=BytesRejectedPerSec,topic=foo-logs,type=BrokerTopicMetrics": {
        "RateUnit": "SECONDS",
        "OneMinuteRate": 789.0,
        "EventType": "bytes",
        "Count": 789,
        "FifteenMinuteRate": 789.0,
        "FiveMinuteRate": 789.0,
        "MeanRate": 789.0
      },
      "kafka.server:name=BytesOutPerSec,topic=foo-logs,type=BrokerTopicMetrics": {
        "RateUnit": "SECONDS",
        "OneMinuteRate": 456.0,
        "EventType": "bytes",
        "Count": 456,
        "FifteenMinuteRate": 456.0,
        "FiveMinuteRate": 456.0,
        "MeanRate": 456.0
      },
      "kafka.server:name=MessagesInPerSec,topic=bar-logs,type=BrokerTopicMetrics": {
        "RateUnit": "SECONDS",
        "OneMinuteRate": 123.0,
        "EventType": "messages",
        "Count": 123,
        "FifteenMinuteRate": 123.0,
        "FiveMinuteRate": 123.0,
        "MeanRate": 123.0
      },
      "kafka.server:name=TotalProduceRequestsPerSec,topic=foo-logs,type=BrokerTopicMetrics": {
        "RateUnit": "SECONDS",
        "OneMinuteRate": 789.0,
        "EventType": "requests",
        "Count": 789,
        "FifteenMinuteRate": 789.0,
        "FiveMinuteRate": 789.0,
        "MeanRate": 789.0
      },
      "kafka.server:name=BytesRejectedPerSec,topic=bar-logs,type=BrokerTopicMetrics": {
        "RateUnit": "SECONDS",
        "OneMinuteRate": 456.0,
        "EventType": "bytes",
        "Count": 456,
        "FifteenMinuteRate": 456.0,
        "FiveMinuteRate": 456.0,
        "MeanRate": 456.0
      },
      "kafka.server:name=FailedFetchRequestsPerSec,topic=bar-logs,type=BrokerTopicMetrics": {
        "RateUnit": "SECONDS",
        "OneMinuteRate": 123.0,
        "EventType": "requests",
        "Count": 123,
        "FifteenMinuteRate": 123.0,
        "FiveMinuteRate": 123.0,
        "MeanRate": 123.0
      },
      "kafka.server:name=FailedProduceRequestsPerSec,topic=foo-logs,type=BrokerTopicMetrics": {
        "RateUnit": "SECONDS",
        "OneMinuteRate": 789.0,
        "EventType": "requests",
        "Count": 789,
        "FifteenMinuteRate": 789.0,
        "FiveMinuteRate": 789.0,
        "MeanRate": 789.0
      },
      "kafka.server:name=BytesOutPerSec,topic=bar-logs,type=BrokerTopicMetrics": {
        "RateUnit": "SECONDS",
        "OneMinuteRate": 456.0,
        "EventType": "bytes",
        "Count": 456,
        "FifteenMinuteRate": 456.0,
        "FiveMinuteRate": 456.0,
        "MeanRate": 456.0
      },
      "kafka.server:name=BytesInPerSec,topic=foo-logs,type=BrokerTopicMetrics": {
        "RateUnit": "SECONDS",
        "OneMinuteRate": 123.0,
        "EventType": "bytes",
        "Count": 123,
        "FifteenMinuteRate": 123.0,
        "FiveMinuteRate": 123.0,
        "MeanRate": 123.0
      },
      "kafka.server:name=TotalProduceRequestsPerSec,topic=bar-logs,type=BrokerTopicMetrics": {
        "RateUnit": "SECONDS",
        "OneMinuteRate": 789.0,
        "EventType": "requests",
        "Count": 789,
        "FifteenMinuteRate": 789.0,
        "FiveMinuteRate": 789.0,
        "MeanRate": 789.0
      }
    },
    "timestamp": 1485055457,
    "status": 200
  }]
'''

[[expects]]
  measurement = "kafka_topic_summary"

  [expects.tags]

  [expects.fields]
    TotalProduceRequestsPerSec_OneMinuteRate      = 123.0
    TotalProduceRequestsPerSec_Count              = 123.0
    TotalProduceRequestsPerSec_FifteenMinuteRate  = 123.0
    TotalProduceRequestsPerSec_FiveMinuteRate     = 123.0
    TotalProduceRequestsPerSec_MeanRate           = 123.0
    TotalProduceRequestsPerSec_RateUnit           = "SECONDS"
    TotalProduceRequestsPerSec_EventType          = "requests"

    BytesOutPerSec_OneMinuteRate                  = 456.0
    BytesOutPerSec_Count                          = 456.0
    BytesOutPerSec_FifteenMinuteRate              = 456.0
    BytesOutPerSec_FiveMinuteRate                 = 456.0
    BytesOutPerSec_MeanRate                       = 456.0
    BytesOutPerSec_RateUnit                       = "SECONDS"
    BytesOutPerSec_EventType                      = "bytes"

    BytesInPerSec_OneMinuteRate                   = 789.0
    BytesInPerSec_Count                           = 789.0
    BytesInPerSec_FifteenMinuteRate               = 789.0
    BytesInPerSec_FiveMinuteRate                  = 789.0
    BytesInPerSec_MeanRate                        = 789.0
    BytesInPerSec_RateUnit                        = "SECONDS"
    BytesInPerSec_EventType                       = "bytes"

    BytesRejectedPerSec_OneMinuteRate             = 123.0
    BytesRejectedPerSec_Count                     = 123.0
    BytesRejectedPerSec_FifteenMinuteRate         = 123.0
    BytesRejectedPerSec_FiveMinuteRate            = 123.0
    BytesRejectedPerSec_MeanRate                  = 123.0
    BytesRejectedPerSec_RateUnit                  = "SECONDS"
    BytesRejectedPerSec_EventType                 = "bytes"

    FailedProduceRequestsPerSec_OneMinuteRate     = 456.0
    FailedProduceRequestsPerSec_Count             = 456.0
    FailedProduceRequestsPerSec_FifteenMinuteRate = 456.0
    FailedProduceRequestsPerSec_FiveMinuteRate    = 456.0
    FailedProduceRequestsPerSec_MeanRate          = 456.0
    FailedProduceRequestsPerSec_RateUnit          = "SECONDS"
    FailedProduceRequestsPerSec_EventType         = "requests"

    MessagesInPerSec_OneMinuteRate                = 789.0
    MessagesInPerSec_Count                        = 789.0
    MessagesInPerSec_FifteenMinuteRate            = 789.0
    MessagesInPerSec_FiveMinuteRate               = 789.0
    MessagesInPerSec_MeanRate                     = 789.0
    MessagesInPerSec_RateUnit                     = "SECONDS"
    MessagesInPerSec_EventType                    = "messages"

    FailedFetchRequestsPerSec_OneMinuteRate       = 123.0
    FailedFetchRequestsPerSec_Count               = 123.0
    FailedFetchRequestsPerSec_FifteenMinuteRate   = 123.0
    FailedFetchRequestsPerSec_FiveMinuteRate      = 123.0
    FailedFetchRequestsPerSec_MeanRate            = 123.0
    FailedFetchRequestsPerSec_RateUnit            = "SECONDS"
    FailedFetchRequestsPerSec_EventType           = "requests"

    TotalFetchRequestsPerSec_OneMinuteRate        = 456.0
    TotalFetchRequestsPerSec_Count                = 456.0
    TotalFetchRequestsPerSec_FifteenMinuteRate    = 456.0
    TotalFetchRequestsPerSec_FiveMinuteRate       = 456.0
    TotalFetchRequestsPerSec_MeanRate             = 456.0
    TotalFetchRequestsPerSec_RateUnit             = "SECONDS"
    TotalFetchRequestsPerSec_EventType            = "requests"

[[expects]]
  measurement = "kafka_topic"

  [expects.tags]
    topic = "foo-logs"

  [expects.fields]
    TotalProduceRequestsPerSec_OneMinuteRate      = 789.0
    TotalProduceRequestsPerSec_Count              = 789.0
    TotalProduceRequestsPerSec_FifteenMinuteRate  = 789.0
    TotalProduceRequestsPerSec_FiveMinuteRate     = 789.0
    TotalProduceRequestsPerSec_MeanRate           = 789.0
    TotalProduceRequestsPerSec_RateUnit           = "SECONDS"
    TotalProduceRequestsPerSec_EventType          = "requests"

    BytesOutPerSec_OneMinuteRate                  = 456.0
    BytesOutPerSec_Count                          = 456.0
    BytesOutPerSec_FifteenMinuteRate              = 456.0
    BytesOutPerSec_FiveMinuteRate                 = 456.0
    BytesOutPerSec_MeanRate                       = 456.0
    BytesOutPerSec_RateUnit                       = "SECONDS"
    BytesOutPerSec_EventType                      = "bytes"

    BytesInPerSec_OneMinuteRate                   = 123.0
    BytesInPerSec_Count                           = 123.0
    BytesInPerSec_FifteenMinuteRate               = 123.0
    BytesInPerSec_FiveMinuteRate                  = 123.0
    BytesInPerSec_MeanRate                        = 123.0
    BytesInPerSec_RateUnit                        = "SECONDS"
    BytesInPerSec_EventType                       = "bytes"

    BytesRejectedPerSec_OneMinuteRate             = 789.0
    BytesRejectedPerSec_Count                     = 789.0
    BytesRejectedPerSec_FifteenMinuteRate         = 789.0
    BytesRejectedPerSec_FiveMinuteRate            = 789.0
    BytesRejectedPerSec_MeanRate                  = 789.0
    BytesRejectedPerSec_RateUnit                  = "SECONDS"
    BytesRejectedPerSec_EventType                 = "bytes"

    FailedProduceRequestsPerSec_OneMinuteRate     = 789.0
    FailedProduceRequestsPerSec_Count             = 789.0
    FailedProduceRequestsPerSec_FifteenMinuteRate = 789.0
    FailedProduceRequestsPerSec_FiveMinuteRate    = 789.0
    FailedProduceRequestsPerSec_MeanRate          = 789.0
    FailedProduceRequestsPerSec_RateUnit          = "SECONDS"
    FailedProduceRequestsPerSec_EventType         = "requests"

    MessagesInPerSec_OneMinuteRate                = 123.0
    MessagesInPerSec_Count                        = 123.0
    MessagesInPerSec_FifteenMinuteRate            = 123.0
    MessagesInPerSec_FiveMinuteRate               = 123.0
    MessagesInPerSec_MeanRate                     = 123.0
    MessagesInPerSec_RateUnit                     = "SECONDS"
    MessagesInPerSec_EventType                    = "messages"

    FailedFetchRequestsPerSec_OneMinuteRate       = 456.0
    FailedFetchRequestsPerSec_Count               = 456.0
    FailedFetchRequestsPerSec_FifteenMinuteRate   = 456.0
    FailedFetchRequestsPerSec_FiveMinuteRate      = 456.0
    FailedFetchRequestsPerSec_MeanRate            = 456.0
    FailedFetchRequestsPerSec_RateUnit            = "SECONDS"
    FailedFetchRequestsPerSec_EventType           = "requests"

    TotalFetchRequestsPerSec_OneMinuteRate        = 789.0
    TotalFetchRequestsPerSec_Count                = 789.0
    TotalFetchRequestsPerSec_FifteenMinuteRate    = 789.0
    TotalFetchRequestsPerSec_FiveMinuteRate       = 789.0
    TotalFetchRequestsPerSec_MeanRate             = 789.0
    TotalFetchRequestsPerSec_RateUnit             = "SECONDS"
    TotalFetchRequestsPerSec_EventType            = "requests"

[[expects]]
  measurement = "kafka_topic"

  [expects.tags]
    topic = "bar-logs"

  [expects.fields]
    TotalProduceRequestsPerSec_OneMinuteRate      = 789.0
    TotalProduceRequestsPerSec_Count              = 789.0
    TotalProduceRequestsPerSec_FifteenMinuteRate  = 789.0
    TotalProduceRequestsPerSec_FiveMinuteRate     = 789.0
    TotalProduceRequestsPerSec_MeanRate           = 789.0
    TotalProduceRequestsPerSec_RateUnit           = "SECONDS"
    TotalProduceRequestsPerSec_EventType          = "requests"

    BytesOutPerSec_OneMinuteRate                  = 456.0
    BytesOutPerSec_Count                          = 456.0
    BytesOutPerSec_FifteenMinuteRate              = 456.0
    BytesOutPerSec_FiveMinuteRate                 = 456.0
    BytesOutPerSec_MeanRate                       = 456.0
    BytesOutPerSec_RateUnit                       = "SECONDS"
    BytesOutPerSec_EventType                      = "bytes"

    BytesInPerSec_OneMinuteRate                   = 456.0
    BytesInPerSec_Count                           = 456.0
    BytesInPerSec_FifteenMinuteRate               = 456.0
    BytesInPerSec_FiveMinuteRate                  = 456.0
    BytesInPerSec_MeanRate                        = 456.0
    BytesInPerSec_RateUnit                        = "SECONDS"
    BytesInPerSec_EventType                       = "bytes"

    BytesRejectedPerSec_OneMinuteRate             = 456.0
    BytesRejectedPerSec_Count                     = 456.0
    BytesRejectedPerSec_FifteenMinuteRate         = 456.0
    BytesRejectedPerSec_FiveMinuteRate            = 456.0
    BytesRejectedPerSec_MeanRate                  = 456.0
    BytesRejectedPerSec_RateUnit                  = "SECONDS"
    BytesRejectedPerSec_EventType                 = "bytes"

    FailedProduceRequestsPerSec_OneMinuteRate     = 789.0
    FailedProduceRequestsPerSec_Count             = 789.0
    FailedProduceRequestsPerSec_FifteenMinuteRate = 789.0
    FailedProduceRequestsPerSec_FiveMinuteRate    = 789.0
    FailedProduceRequestsPerSec_MeanRate          = 789.0
    FailedProduceRequestsPerSec_RateUnit          = "SECONDS"
    FailedProduceRequestsPerSec_EventType         = "requests"

    MessagesInPerSec_OneMinuteRate                = 123.0
    MessagesInPerSec_Count                        = 123.0
    MessagesInPerSec_FifteenMinuteRate            = 123.0
    MessagesInPerSec_FiveMinuteRate               = 123.0
    MessagesInPerSec_MeanRate                     = 123.0
    MessagesInPerSec_RateUnit                     = "SECONDS"
    MessagesInPerSec_EventType                    = "messages"

    FailedFetchRequestsPerSec_OneMinuteRate       = 123.0
    FailedFetchRequestsPerSec_Count               = 123.0
    FailedFetchRequestsPerSec_FifteenMinuteRate   = 123.0
    FailedFetchRequestsPerSec_FiveMinuteRate      = 123.0
    FailedFetchRequestsPerSec_MeanRate            = 123.0
    FailedFetchRequestsPerSec_RateUnit            = "SECONDS"
    FailedFetchRequestsPerSec_EventType           = "requests"

    TotalFetchRequestsPerSec_OneMinuteRate        = 123.0
    TotalFetchRequestsPerSec_Count                = 123.0
    TotalFetchRequestsPerSec_FifteenMinuteRate    = 123.0
    TotalFetchRequestsPerSec_FiveMinuteRate       = 123.0
    TotalFetchRequestsPerSec_MeanRate             = 123.0
    TotalFetchRequestsPerSec_RateUnit             = "SECONDS"
    TotalFetchRequestsPerSec_EventType            = "requests"
